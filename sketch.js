let imgFileNames= ['$26.00.jpg', '1093785krw.jpg', '1717q16deleted.jpg', '2YardsOfOrganza.jpg', '3620fujifilm.jpg', '3DScanRoom.jpg', '845today.jpg', 'acceptances.jpg', 'accountSign-ins.jpg', 'acnepatch.jpg', 'ahhhh.jpg', 'aliencat.jpg', 'ALL1N_Wallpaper.jpg', 'allAPPpasswords.jpg', 'allAPPpasswords2.jpg', 'angelaonthebigscreen.jpg', 'apartmentsNyc.jpg', 'apcsMaze.jpg', 'BajaBlast.jpg', 'bananapile.jpg', 'BarneyGallery.jpg', 'bathroombreak.jpg', 'bathroomPoster.jpg', 'bigwin.jpg', 'BM3730_sewing_machine.jpg', 'bug.jpg', 'casestudy.jpg', 'casio.jpg', 'CAUGHT.jpg', 'ccd.jpg', 'ccd020725.jpg', 'ccd2.jpg', 'chanchan.jpg', 'chanchan2.jpg', 'ChinaVisaApp.jpg', 'chsID.jpg', 'class7score_85.jpg', 'collectibles.jpg', 'commonAppPlan.jpg', 'CopyOfaCopyOfaCopy.jpg', 'cosmicsea.jpg', 'covidtest3132022.jpg', 'cutenaildesign.jpg', 'cvsCheckout.jpg', 'demure.jpg', 'deskspread2.jpg', 'ego.jpg', 'emailtoevan.jpg', 'energyinteraction.jpg', 'EtymologyofArctic.jpg', 'excerptfrom.jpg', 'expired.jpg', 'Fairmont.jpg', 'feelingblue.jpg', 'figuredrawing.jpg', 'figures2.jpg', 'fillthesejars.jpg', 'FinalPrez.jpg', 'floating.jpg', 'fruitstickers.jpg', 'Gangnum-Gu_trash.jpg', 'glitch.jpg', 'glitch2.jpg', 'googletranslate.jpg', 'gordon.jpg', 'govofcanada.jpg', 'graffitiRoom.jpg', 'granvilleisland.jpg', 'GST_registration.jpg', 'herObsession.jpg', 'hideaway.jpg', 'holographic.jpg', 'hotsummer.jpg', 'icloudpassword2020.jpg', 'iHoard.jpg', 'iHoard2.jpg', 'iHoard3.jpg', 'iHoard4.jpg', 'iHoard5.jpg', 'IMG_1857.jpg', 'IMG_3194.jpg', 'IMG_3445.jpg', 'IMG_3579.jpg', 'IMG_4187.jpg', 'IMG_5122.jpg', 'IMG_5237.jpg', 'IMG_5729.jpg', 'IMG_5919.jpg', 'IMG_6439.jpg', 'IMG_7194.jpg', 'IMG_7197.jpg', 'IMG_7213.jpg', 'IMG_8292.jpg', 'IMG_8945.jpg', 'IMG_9021.jpg', 'IMG_9137.jpg', 'importantDoc2021.jpg', 'indaclerb.jpg', 'ineedsome.jpg', 'insta_poll.jpg', 'instructions.jpg', 'ipadgrandpa.jpg', 'Ishoulddosomething.jpg', 'jerrygogosian1.jpg', 'jerrygogosian2.jpg', 'jerrygogosian3.jpg', 'jojoCereal.jpg', 'kater_outofstock_forever.jpg', 'keepOUT.jpg', 'kitty.jpg', 'LAX5dayplan.jpg', 'letterTo_.jpg', 'LicenceOLD.jpg', 'lindatheworm.jpg', 'lizardskin.jpg', 'lostKitty.jpg', 'MacSailing.jpg', 'Marchschedule.jpg', 'mask.jpg', 'memoresofMatsuko2.jpg', 'memoriesofMatsuko.jpg', 'memoriesofMatsuko3.jpg', 'mindmap.jpg', 'mirrorpic.jpg', 'mirrorselfie.jpg', 'moretrash.jpg', 'mother1986.jpg', 'mo_An.jpg', 'myCube.jpg', 'nakedMoleRat.jpg', 'needs2beHumbled.jpg', 'newMAC.jpg', 'newyears&Dog.jpg', 'nightview.jpg', 'oldTV.jpg', 'oldTV2.jpg', 'omeglechat.jpg', 'omwToTinaLees.jpg', 'onFilm2.jpg', 'organizedchaos.jpg', 'password_dcclxviii.jpg', 'pastelonpaper.jpg', 'pastelonpaper2.jpg', 'PC11_99percent.jpg', 'penpals1301.jpg', 'photoday2022.jpg', 'pink_tutu.jpg', 'poetry.jpg', 'polaroid2022.jpg', 'PortaPotty.jpg', 'postedbyiphone5.jpg', 'preschoolGal.jpg', 'press_on_nails.jpg', 'printedpapers.jpg', 'PSlightningGal.jpg', 'rejectedAF.jpg', 'saturated.jpg', 'Screenshot_2019-09-23_at_06.19.32\u202fPM.jpg', 'secretrecoveryphrase.jpg', 'securitycam.jpg', 'selfieSky.jpg', 'sentfromMaiko.jpg', 'sheep.jpg', 'sheep3.jpg', 'sheplaystheguitar.jpg', 'sittingmeditation.jpg', 'sketchbook.jpg', 'sketchbook2.jpg', 'sketchbook3.jpg', 'sky07232011.jpg', 'slideroom.jpg', 'slurp.jpg', 'smartSEOregister.jpg', 'snoozing.jpg', 'somecityscape.jpg', 'SpanishConjugations.jpg', 'spread2.jpg', 'squarehairsalon.jpg', 'starterpack.jpg', 'stickersspread.jpg', 'storeinKor.jpg', 'streetfighters.jpg', 'strength_in_numbers.jpg', 'suffocating.jpg', 'testcenter.jpg', 'thanks_evan.jpg', 'TheAmbiguousCase.jpg', 'thruMyLens.jpg', 'TimsThursClass.jpg', 'to-do-list_yg.jpg', 'Toilet.jpg', 'tools.jpg', 'trashjuice.jpg', 'twinning.jpg', 'ultraman.jpg', 'unsaturated.jpg', 'urbansource.jpg', 'vacay_dump.jpg', 'vancouver2014.jpg', 'wallofrecords.jpg', 'warmthofsoul.jpg', 'warnings.jpg', 'watermania.jpg', 'WhenParabolaInteresectsTheLine.jpg', 'whiteboarding.jpg', 'xixi4302022.jpg', 'y=10.9332239411.jpg', '中国签证中心.jpg', '占星命盘.jpg', '喜洋洋头套.jpg', '小姐.jpg', '我们仨us.jpg', '普罗旺斯for_sale.jpg', '椰树牌椰汁parody.jpg', '网友Yulu.jpg', '表情包.jpg', '表情包10.jpg', '表情包11.jpg', '表情包17.jpg', '表情包2.jpg', '表情包3.jpg', '表情包5.jpg', '表情包6.jpg', '表情包7.jpg', '表情包8.jpg','flip.gif', 'gala.gif', 'runner.gif', 'smoochfromwho.gif', 'subway.gif', 'throwapunch.gif', '混乱.gif']
let bg
let imgFiles = []
let draggableImgs = []
let dragging = false
let dClick = false
let offsetX = -1, offsetY = -1
let selectIndex = -1;
let openIndex = -1
let randX,randY
let button
let state = 0
let videoFileNames = ['bananaCall.mov', 'congratsEric.mp4', 'congratsRunbo.mp4', 'danceGarfield.mp4', 'flipbook.mp4', 'imagetrace.mp4', 'littlelisa.mp4', 'PartyAtKimberlys.mov', 'runboSkates.mov', 'sheepVid.mp4', 'studiosummer.mp4', 'TheatreREC.mp4', '幸福小串securitycam.mov']
let videoFiles = []
function preload() {
  for (let i = 0; i < imgFileNames.length; i++) {
    let img = loadImage("assets_a/" + imgFileNames[i])
    // img.resize(50,0)
    imgFiles.push(img)
  }
  // for (let i = 0; i < videoFileNames.length; i++) {
  //   let vid = createVideo("assets_a/" +videoFileNames[i])
  //   vid.onloadedmetadata = () => {
  //     vid.time(0);  // 将视频时间设置为 0，定格在第一帧
  //     vid.pause();  // 停止播放
  //   };
  //   videoFiles.push(vid)
  //   vid.hide()
  // }
  bg = loadImage("assets_a/bg.jpg")
}
function showTime(){
    // 获取当前的日期和时间
    let currentDate = new Date();
  
    // 获取星期、月份、日期、小时和分钟
    let weekday = currentDate.toLocaleString('en-US', { weekday: 'short' });  // "Sun"
    let month = currentDate.toLocaleString('en-US', { month: 'short' });  // "Feb"
    let day = currentDate.getDate();  // "23"
    let hour = currentDate.getHours();  // "10"
    let minute = currentDate.getMinutes();  // "29"
  
    // 确保分钟是两位数
    if (minute < 10) {
      minute = '0' + minute;  // 补充零
    }
  
    // 确保小时为12小时制并添加AM/PM
    let ampm = hour >= 12 ? 'PM' : 'AM';
    hour = hour % 12;  // 转换为12小时制
    hour = hour ? hour : 12; // 如果小时是0，改为12
  
    // 格式化日期和时间为 "Sun Feb 23 10:29PM"
    let formattedDate = `${weekday} ${month} ${day}  ${hour}:${minute}${ampm}`;
  
    // 显示格式化后的日期和时间
    textSize(20)
    text(formattedDate, width*0.9, height*0.01);
}
function setFullScreen(){
  let fs = fullscreen();  // 获取当前全屏状态
  if (!fs) {
    fullscreen(true);  // 如果没有全屏，则设置为全屏
  }
  button.hide()
  state=1
  // for (let i = 0; i < videoFiles.length; i++) {
  //   videoFiles[i].
    

  // }
}
function setup() {
  // createCanvas(windowWidth, 0.65*windowWidth);
  createCanvas(windowWidth, windowHeight); // 创建一个占据整个屏幕的画布
  button  = createButton("Start")
  button.position(width/2,height/2)
  button.mouseClicked(setFullScreen)
  
  imageMode(CENTER)
  // image(bg, width / 2, height / 2, width, height)
  for (let i = 0; i < imgFiles.length; i++) {
    let dImg = new DraggableImg(imgFiles[i], imgFileNames[i])
    draggableImgs.push(dImg)
  }
  // for (let i = 0; i < videoFiles.length; i++) {
  //   let dImg = new DraggableImg(videoFiles[i], videoFileNames[i])
  //   // videoFiles[i].play()
  //   draggableImgs.push(dImg)
  //   console.log(dImg.pos.x/width,dImg.pos.y/height)
  // }


}
function mouseClicked() {
  console.log((mouseX / width).toFixed(2), (mouseY / height).toFixed(2))
}
function draw() {
  if(state==0){
   
  }
  if(state==1){
    image(bg, width / 2, height / 2, width, height)
    showTime()

    // background(220);
    for (let i = 0; i < draggableImgs.length; i++) {
      draggableImgs[i].display()
    }
  
  
    if (selectIndex > -1) {
      dragImg = draggableImgs[selectIndex]
      dragImg.display()
  
      dragImg.pos.x = mouseX - offsetX
      dragImg.pos.y = mouseY - offsetY
    } else {
  
      for (let i = draggableImgs.length - 1; i >= 0; i--) {
        let dragImg = draggableImgs[i]
        if (dragging == true) {
          if (dragImg.inArea() == true) {
            if (offsetX == -1 && offsetY == -1) {
              offsetX = mouseX - dragImg.pos.x
              offsetY = mouseY - dragImg.pos.y
              selectIndex = i
            }
  
            break;
          }
        }
        if(dClick==true){
          if (dragImg.inArea() == true) {
             openIndex = i
             let w = imgFiles[openIndex].width /imgFiles[openIndex].height*height*0.7 
             let h = height*0.6
             randX = random(w/2,width-w/2)
             randY = random(h/2+height * 0.04,height*0.94-h/2)
             break;
          }
        }
      }
  
    }
  
    if(openIndex>-1){
      let w = imgFiles[openIndex].width /imgFiles[openIndex].height*height*0.7 
      let h = height*0.6
      imgFiles[openIndex].play()
      image(imgFiles[openIndex],randX,randY,w,h)

  
      if(mouseIsPressed){
        let w = imgFiles[openIndex].width/imgFiles[openIndex].height*height*0.7 
      let h = height*0.6
        if(abs(mouseX-randX)<w/2 && abs(mouseY-randY)<h/2){
          openIndex = -1
        }
      }
    }
    // }
      
    
    dClick = false
  
  }
  
}
class DraggableImg {
  constructor(img, name) {
    this.img = img
    this.name = name
    this.w = random([width/30, width/35])
    this.h = this.img.height / this.img.width * this.w
    this.pos = createVector(random(width/30 / 2, width - width/30 / 2), random(height * 0.04 + this.h / 2, height * 0.94 - this.h))

  }
  display() {
    this.img.pause()
    image(this.img, this.pos.x, this.pos.y, this.w, this.h)
    fill(255)
    textSize(12)
    textAlign(CENTER)
    text(this.name, this.pos.x, this.pos.y + this.h / 2 + 15)
  }
  inArea() {
    // if(dragging){
    if (abs(mouseX - this.pos.x) < this.w / 2 && abs(mouseY - this.pos.y) < this.h / 2) {
      return true
    }
    // }
    return false

  }
}

function mouseDragged() {
  dragging = true
}
function mouseReleased() {
  dragging = false
  selectIndex = -1
  offsetX = -1
  offsetY = -1

}
function doubleClicked() {
  dClick = true
  console.log("dclick", dClick)
}
function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
}